---
title: 移行とアップグレード
sidebar_position: 0
image: og/docs/more-resources.jpg
# tags: ['migration']
---

## アップグレード

Weaviate は活発に開発が進められており、新機能や改良、バグ修正が定期的に追加されています。これらのアップデートを活用するために、Weaviate インスタンスを定期的にアップグレードすることをおすすめします。

### 一般的なアップグレード手順

Weaviate をアップグレードする際は、次の手順を推奨します。

1. アップグレードを開始する前に、現在の Weaviate インスタンスの [バックアップ](/deploy/configuration/backups.md) を完全に作成します。  
1. 常に各マイナーリリースの最新パッチバージョンを使用しながら、1 つのマイナー バージョンずつ順番にアップグレードします。

マイナー バージョンを 1 つずつアップグレードすることで、弊社のテストおよびリリースプロセスを反映し、アップグレード中のリスクを最小限に抑えられます。また、各マイナーリリースの最新パッチバージョンを使用することで、最新のバグ修正と改良を取り込めます。

### バージョン別移行ガイド

- `1.24.x`（またはそれ以前）から `1.25.x` にアップグレードする場合、[Raft マイグレーション](#raft-マイグレーション-v1250) が必要です。  
- 前バージョンから `1.26.x` 以降へアップグレードする場合、クラスタメタデータが同期されていることを確認してください。  
    - `/cluster/statistics` エンドポイントをポーリングし、正しいノード数が統計を返し、`synchronized` フラグが `true` になっていることを確認してからアップグレードを続行します。  
    - 実装例は [`wait_for_raft_sync` 関数](https://github.com/weaviate/weaviate-local-k8s/blob/main/utilities/helpers.sh) を参照してください。

:::tip シナリオ: `v1.25.10` から `v1.27` へのアップグレード

`v1.25` と `v1.27` の間には `v1.26` と `v1.27` の 2 つのマイナー バージョンがあります。したがって:
<br/>

1. 現在の Weaviate インスタンスのバックアップを作成します。  
1. [Weaviate リリースページ](https://github.com/weaviate/weaviate/tags) にアクセスし、  
    1. 最新の `v1.26` パッチバージョン（例: `1.26.11`）を探します。  
    1. 最新の `v1.27` パッチバージョン（例: `1.27.5`）を探します。  
1. `v1.26` の最新パッチバージョンへアップグレードします。  
1. 続いて `v1.27` の最新パッチバージョンへアップグレードします。  

:::

### Raft マイグレーション (v1.25.0+)

Weaviate `v1.25.0` では、[クラスタメタデータの合意アルゴリズムとして Raft を導入しました](/weaviate/concepts/replication-architecture/cluster-architecture#metadata-replication-raft)。これにより、クラスタメタデータの一度きりのマイグレーションが必要です。

[Docker ベースのセルフホスト環境](/deploy/installation-guides/docker-installation.md) では、マイグレーションは自動で行われます。

[Kubernetes ベースのセルフホスト環境](/deploy/installation-guides/k8s-installation.md) では、手動でマイグレーションを実行する必要があります。詳細は [Weaviate `v1.25.0` マイグレーションガイド](./weaviate-1-25.md) を参照してください。

これは Weaviate アーキテクチャにおける大きな変更です。そのため、`v1.25.latest` へアップグレードした後、さらにアップグレードを進める前にもう一度バックアップを取得しておくことを推奨します。

### バックアップリストアの修正 (v1.23.13+)

`v1.23.13` より前のバージョンでは、バックアップリストア処理に不具合があり、データが正しく保存されない可能性がありました。

`v1.23.13` より前のバージョンからアップグレードする場合は、次の手順を推奨します。

1. 現在の Weaviate インスタンスのバックアップを作成します。  
2. 上記の[一般的なアップグレード手順](#一般的なアップグレード手順)に従い、少なくとも `v1.23.13`（可能なら `v1.23.16`）以上へアップグレードします。  
3. アップグレード後のインスタンスにバックアップをリストアします。  

## ダウングレード

### RAFT スナップショット (v1.28.13+, v1.29.5+, v1.30.2+)

`1.28.13+`、`1.29.5+`、`1.30.2+` を実行する複数ノードの Weaviate インスタンスを `v1.27.x`（`1.27.26` より前）へダウングレードすると、データベースでの RAFT スナップショットの保存方式変更によりクラスタが **Ready** 状態に到達しない問題が発生する可能性があります。

この問題の修正は `1.27.26` でリリースされ、`1.27` への安全なダウングレードが可能になります。

Weaviate を `v1.27.x` にダウングレードする必要がある場合は、`1.27.26` 以上を使用してください。

## 質問とフィードバック

import DocsFeedback from '/_includes/docs-feedback.mdx';

<DocsFeedback/>

