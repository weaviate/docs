---
title: マルチテナンシーの操作
sidebar_position: 4
image: og/docs/configuration.jpg
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import FilteredTextBlock from "@site/src/components/Documentation/FilteredTextBlock";
import PyCode from "!!raw-loader!/_includes/code/howto/manage-data.multi-tenancy.py";
import PyCodeV3 from "!!raw-loader!/_includes/code/howto/manage-data.multi-tenancy-v3.py";
import TSCode from "!!raw-loader!/_includes/code/howto/manage-data.multi-tenancy.ts";
import TSCodeLegacy from "!!raw-loader!/_includes/code/howto/manage-data.multi-tenancy-v2.ts";
import JavaCode from "!!raw-loader!/_includes/code/howto/java/src/test/java/io/weaviate/docs/manage-data.multi-tenancy.java";
import GoCode from "!!raw-loader!/_includes/code/howto/go/docs/manage-data.multi-tenancy_test.go";
import GoCodeAuto from "!!raw-loader!/_includes/code/howto/go/docs/manage-data.create_auto-multitenancy.go";
import CurlCode from "!!raw-loader!/_includes/code/howto/manage-data.multi-tenancy-curl.sh";
import SkipLink from "/src/components/SkipValidationLink";

マルチテナンシーはデータの分離を提供します。各テナントは個別のシャードに保存され、あるテナントに保存されたデータは他のテナントからは見えません。アプリケーションが多数のユーザーにサービスを提供する場合、マルチテナンシーによりユーザーデータを非公開に保ち、データベース操作を効率化できます。

<details>
  <summary>
    マルチテナンシーの対応状況
  </summary>

- `v1.20` でマルチテナンシーを追加  
- `v1.21` でテナントのアクティビティステータス設定を追加  
- `v1.25.0` でバッチインポート時の自動テナント作成を追加  
- `v1.25.2` で単一オブジェクト挿入時の自動テナント作成を追加  
- `v1.25.2` で自動テナントアクティベーションを追加  

</details>

:::info `v1.26` でテナントステータスの名称変更
`v1.26` では、`HOT` ステータスは `ACTIVE` に、`COLD` ステータスは `INACTIVE` に変更されました。
:::

## マルチテナンシーの有効化

デフォルトでは マルチテナンシー は無効です。マルチテナンシーを有効にするには、コレクション定義で `multiTenancyConfig` を設定します。

<Tabs groupId="languages">
  <TabItem value="py" label="Python クライアント v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START EnableMultiTenancy"
      endMarker="# END EnableMultiTenancy"
      language="py"
    />
  </TabItem>
  <TabItem value="py3" label="Python クライアント v3">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# START EnableMultiTenancy"
      endMarker="# END EnableMultiTenancy"
      language="pyv3"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS クライアント v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START EnableMultiTenancy"
      endMarker="// END EnableMultiTenancy"
      language="ts"
    />
  </TabItem>
  <TabItem value="js2" label="JS/TS クライアント v2">
    <FilteredTextBlock
      text={TSCodeLegacy}
      startMarker="// START EnableMultiTenancy"
      endMarker="// END EnableMultiTenancy"
      language="tsv2"
    />
  </TabItem>
  <TabItem value="java" label="Java">
    <FilteredTextBlock
      text={JavaCode}
      startMarker="// START EnableMultiTenancy"
      endMarker="// END EnableMultiTenancy"
      language="java"
    />
  </TabItem>
  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START EnableMultiTenancy"
      endMarker="// END EnableMultiTenancy"
      language="go"
    />
  </TabItem>
</Tabs>

## 新しいテナントを自動追加

import AutoTenant from "/_includes/auto-tenant.mdx";

<AutoTenant />

### コレクションの作成

<Tabs groupId="languages">
  <TabItem value="py" label="Python クライアント v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START EnableAutoMT"
      endMarker="# END EnableAutoMT"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS クライアント v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START EnableAutoMT"
      endMarker="// END EnableAutoMT"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCodeAuto}
      startMarker="// START enable autoMT"
      endMarker="// END enable autoMT"
      language="bash"
    />
  </TabItem>
  <TabItem value="cURL" label="cURL">
    <FilteredTextBlock
      text={CurlCode}
      startMarker="# START CreateWithAMT"
      endMarker="# END CreateWithAMT"
      language="py"
    />
  </TabItem>
</Tabs>



### コレクションの更新

クライアントを使用して auto-tenant 作成設定を更新します。auto-tenant はバッチ挿入でのみ利用できます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START UpdateAutoMT"
      endMarker="# END UpdateAutoMT"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START UpdateAutoMT"
      endMarker="// END UpdateAutoMT"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCodeAuto}
      startMarker="// Start update autoMT"
      endMarker="// END update autoMT"
      language="bash"
    />
  </TabItem>
</Tabs>

## 新しいテナントの手動追加

コレクションにテナントを追加するには、対象のコレクションと新しいテナントを指定します。必要に応じて、テナントのアクティブ状態を `ACTIVE`（利用可能、デフォルト）、`INACTIVE`（利用不可、ディスク上）、または `OFFLOADED`（利用不可、[クラウドへオフロード](../concepts/data.md#tenant-states)）として指定できます。

以下の例では、`MultiTenancyCollection` コレクションに `tenantA` を追加しています。

<details>
  <summary>
    追加情報
  </summary>

import TenantNameFormat from "/_includes/tenant-names.mdx";

テナントステータスは Weaviate `1.21` 以降で利用可能です。

<br />

<TenantNameFormat />

</details>

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START AddTenantsToClass"
      endMarker="# END AddTenantsToClass"
      language="py"
    />
  </TabItem>

<TabItem value="py3" label="Python Client v3">
  <FilteredTextBlock
    text={PyCodeV3}
    startMarker="# START AddTenantsToClass"
    endMarker="# END AddTenantsToClass"
    language="pyv3"
  />
</TabItem>

<TabItem value="js" label="JS/TS Client v3">
  <FilteredTextBlock
    text={TSCode}
    startMarker="// START AddTenantsToClass"
    endMarker="// END AddTenantsToClass"
    language="ts"
  />
</TabItem>

<TabItem value="js2" label="JS/TS Client v2">
  <FilteredTextBlock
    text={TSCodeLegacy}
    startMarker="// START AddTenantsToClass"
    endMarker="// END AddTenantsToClass"
    language="tsv2"
  />
</TabItem>

<TabItem value="java" label="Java">
  <FilteredTextBlock
    text={JavaCode}
    startMarker="// START AddTenantsToClass"
    endMarker="// END AddTenantsToClass"
    language="java"
  />
</TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START AddTenantsToClass"
      endMarker="// END AddTenantsToClass"
      language="go"
    />
  </TabItem>
</Tabs>

## テナントの一覧

既存のテナントをコレクション内で一覧表示します。

この例では、`MultiTenancyCollection` コレクションに含まれるテナントを一覧表示します。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START ListTenants"
      endMarker="# END ListTenants"
      language="py"
    />
  </TabItem>

<TabItem value="py3" label="Python Client v3">
  <FilteredTextBlock
    text={PyCodeV3}
    startMarker="# START ListTenants"
    endMarker="# END ListTenants"
    language="pyv3"
  />
</TabItem>

<TabItem value="js" label="JS/TS Client v3">
  <FilteredTextBlock
    text={TSCode}
    startMarker="// START ListTenants"
    endMarker="// END ListTenants"
    language="ts"
  />
</TabItem>

<TabItem value="js2" label="JS/TS Client v2">
  <FilteredTextBlock
    text={TSCodeLegacy}
    startMarker="// START ListTenants"
    endMarker="// END ListTenants"
    language="tsv2"
  />
</TabItem>

<TabItem value="java" label="Java">
  <FilteredTextBlock
    text={JavaCode}
    startMarker="// START ListTenants"
    endMarker="// END ListTenants"
    language="java"
  />
</TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START ListTenants"
      endMarker="// END ListTenants"
      language="go"
    />
  </TabItem>
</Tabs>


## 名前でのテナント取得

コレクションから名前を指定してテナントを取得します。存在しないテナント名はレスポンスで無視される点に注意してください。

次の例では、`MultiTenancyCollection` コレクションから `tenantA` と `tenantB` を返します:

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START GetTenantsByName"
      endMarker="# END GetTenantsByName"
      language="py"
    />
  </TabItem>

<TabItem value="js" label="JS/TS Client v3">
  <FilteredTextBlock
    text={TSCode}
    startMarker="// START GetTenantsByName"
    endMarker="// END GetTenantsByName"
    language="ts"
  />
</TabItem>

</Tabs>

## 単一テナントの取得

コレクションから特定のテナントを取得します。

次の例では、`MultiTenancyCollection` コレクションからテナントを返します:

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START GetOneTenant"
      endMarker="# END GetOneTenant"
      language="py"
    />
  </TabItem>

<TabItem value="js" label="JS/TS Client v3">
  <FilteredTextBlock
    text={TSCode}
    startMarker="// START GetOneTenant"
    endMarker="// END GetOneTenant"
    language="ts"
  />
</TabItem>

</Tabs>

## テナントの削除

テナントをコレクションから削除するには、コレクション（例: `MultiTenancyCollection`）とテナント（`tenantB` と `tenantX`）を指定します。指定されたテナントがコレクションに含まれていない場合、その名前は無視されます。

:::caution テナント削除 ＝ テナント データ削除
テナントを削除すると、関連するすべてのオブジェクトも削除されます。
:::

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START RemoveTenants"
      endMarker="# END RemoveTenants"
      language="py"
    />
  </TabItem>

<TabItem value="py3" label="Python Client v3">
  <FilteredTextBlock
    text={PyCodeV3}
    startMarker="# START RemoveTenants"
    endMarker="# END RemoveTenants"
    language="pyv3"
  />
</TabItem>

<TabItem value="js" label="JS/TS Client v3">
  <FilteredTextBlock
    text={TSCode}
    startMarker="// START RemoveTenants"
    endMarker="// END RemoveTenants"
    language="ts"
  />
</TabItem>

<TabItem value="js2" label="JS/TS Client v2">
  <FilteredTextBlock
    text={TSCodeLegacy}
    startMarker="// START RemoveTenants"
    endMarker="// END RemoveTenants"
    language="tsv2"
  />
</TabItem>

<TabItem value="java" label="Java">
  <FilteredTextBlock
    text={JavaCode}
    startMarker="// START RemoveTenants"
    endMarker="// END RemoveTenants"
    language="java"
  />
</TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START RemoveTenants"
      endMarker="// END RemoveTenants"
      language="go"
    />
  </TabItem>
</Tabs>

## テナント状態の管理

`ACTIVE`、`INACTIVE`、`OFFLOADED` の間でテナントの状態を変更します。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START ChangeTenantState"
      endMarker="# END ChangeTenantState"
      language="py"
    />
  </TabItem>

  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START ChangeTenantState"
      endMarker="// END ChangeTenantState"
      language="ts"
    />
  </TabItem>
</Tabs>

:::info 詳細はこちら

より実践的な例については [ハウツー: テナント状態を管理する](./tenant-states.mdx) を参照してください。また、**ホット**、**ウォーム**、**コールド** の各ストレージ階層を管理する方法については、[ガイド: リソースの管理](../starter-guides/managing-resources/index.md) もご覧ください。

:::

## CRUD 操作

マルチテナンシーコレクションでは、各 CRUD 操作にテナント名（例：`tenantA`）を指定する必要があります。以下のオブジェクト作成例をご覧ください。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START CreateMtObject"
      endMarker="# END CreateMtObject"
      language="py"
    />
  </TabItem>

<TabItem value="py3" label="Python Client v3">
  <FilteredTextBlock
    text={PyCodeV3}
    startMarker="# START CreateMtObject"
    endMarker="# END CreateMtObject"
    language="pyv3"
  />
</TabItem>

<TabItem value="js" label="JS/TS Client v3">
  <FilteredTextBlock
    text={TSCode}
    startMarker="// START CreateMtObject"
    endMarker="// END CreateMtObject"
    language="ts"
  />
</TabItem>

<TabItem value="js2" label="JS/TS Client v2">
  <FilteredTextBlock
    text={TSCodeLegacy}
    startMarker="// START CreateMtObject"
    endMarker="// END CreateMtObject"
    language="tsv2"
  />
</TabItem>

<TabItem value="java" label="Java">
  <FilteredTextBlock
    text={JavaCode}
    startMarker="// START CreateMtObject"
    endMarker="// END CreateMtObject"
    language="java"
  />
</TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START CreateMtObject"
      endMarker="// END CreateMtObject"
      language="go"
    />
  </TabItem>
</Tabs>

## 検索クエリ

マルチテナンシーコレクションでは、`Get` および `Aggregate` クエリを実行するたびにテナント名（例：`tenantA`）を指定する必要があります。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START Search"
      endMarker="# END Search"
      language="py"
    />
  </TabItem>

<TabItem value="py3" label="Python Client v3">
  <FilteredTextBlock
    text={PyCodeV3}
    startMarker="# START Search"
    endMarker="# END Search"
    language="pyv3"
  />
</TabItem>

<TabItem value="js" label="JS/TS Client v3">
  <FilteredTextBlock
    text={TSCode}
    startMarker="// START Search"
    endMarker="// END Search"
    language="ts"
  />
</TabItem>

<TabItem value="js2" label="JS/TS Client v2">
  <FilteredTextBlock
    text={TSCodeLegacy}
    startMarker="// START Search"
    endMarker="// END Search"
    language="tsv2"
  />
</TabItem>

<TabItem value="java" label="Java">
  <FilteredTextBlock
    text={JavaCode}
    startMarker="// START Search"
    endMarker="// END Search"
    language="java"
  />
</TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START Search"
      endMarker="// END Search"
      language="go"
    />
  </TabItem>
</Tabs>

## クロスリファレンス

import CrossReferencePerformanceNote from "/_includes/cross-reference-performance-note.mdx";

<CrossReferencePerformanceNote />

マルチテナンシー コレクション オブジェクトから、次のいずれかにクロスリファレンスを追加できます:

- 非マルチテナンシー コレクション オブジェクト
- 同じテナントに属するオブジェクト

クロスリファレンスを作成、更新、削除する際、マルチテナンシー コレクションではテナント名（例: `tenantA`）が必須です。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START AddCrossRef"
      endMarker="# END AddCrossRef"
      language="py"
    />
  </TabItem>

<TabItem value="py3" label="Python Client v3">
  <FilteredTextBlock
    text={PyCodeV3}
    startMarker="# START AddCrossRef"
    endMarker="# END AddCrossRef"
    language="pyv3"
  />
</TabItem>

<TabItem value="js" label="JS/TS Client v3">
  <FilteredTextBlock
    text={TSCode}
    startMarker="// START AddCrossRef"
    endMarker="// END AddCrossRef"
    language="ts"
  />
</TabItem>

<TabItem value="js2" label="JS/TS Client v2">
  <FilteredTextBlock
    text={TSCodeLegacy}
    startMarker="// START AddCrossRef"
    endMarker="// END AddCrossRef"
    language="tsv2"
  />
</TabItem>

<TabItem value="java" label="Java">
  <FilteredTextBlock
    text={JavaCode}
    startMarker="// START AddCrossRef"
    endMarker="// END AddCrossRef"
    language="java"
  />
</TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START AddCrossRef"
      endMarker="// END AddCrossRef"
      language="go"
    />
  </TabItem>
</Tabs>

## バックアップ

:::caution 非アクティブまたはオフロード済みテナントはバックアップに含まれません
[マルチテナント コレクション](../concepts/data.md#multi-tenancy)のバックアップには `active` テナントのみが含まれ、`inactive` や `offloaded` テナントは含まれません。すべてのデータをバックアップに含めるために、バックアップ作成前に [テナントをアクティブにする](#manage-tenant-states) ことを推奨します。
:::

## 関連ページ

- [Weaviate への接続](/weaviate/connections/index.mdx)
- [How to: コレクションを管理する](../manage-collections/index.mdx)
- <SkipLink href="/weaviate/api/rest#tag/schema">参照: REST API: スキーマ</SkipLink>
- [概念: データ構造: マルチテナンシー](../concepts/data.md#multi-tenancy)

## 質問とフィードバック

import DocsFeedback from "/_includes/docs-feedback.mdx";

<DocsFeedback />

