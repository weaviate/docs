---
title: キーワード & ハイブリッド検索
description: オブジェクトコレクションにおけるハイブリッドキーワード検索
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import FilteredTextBlock from '@site/src/components/Documentation/FilteredTextBlock';
import PyCode from '!!raw-loader!../_snippets/103_20_searches.py';

キーワードの類似度に基づいてアイテムを検索するキーワード ( BM25 ) 検索、または BM25 とセマンティック / ベクトル検索を組み合わせたハイブリッド検索も実行できます。

## <i class="fa-solid fa-square-chevron-right"></i> キーワード検索

### <i class="fa-solid fa-code"></i> コード

この例では、"Movie" コレクション内から "history" という用語に対して最も高いキーワード検索スコアを持つエントリーを取得し、上位 5 件のタイトルと公開年を出力します。

<FilteredTextBlock
  text={PyCode}
  startMarker="# MetadataBM25Search"
  endMarker="# END MetadataBM25Search"
  language="py"
/>

### <i class="fa-solid fa-chalkboard"></i> コードの解説

結果は、いわゆる [BM25f](https://en.wikipedia.org/wiki/Okapi_BM25) アルゴリズムを使用したキーワード検索スコアに基づいています。

`limit` パラメーターは、返却する最大件数を設定します。

`return_metadata` パラメーターには `MetadataQuery` クラスのインスタンスを渡し、検索結果で返却するメタデータを指定します。現在のクエリでは BM25 スコアである `score` を返却しています。

<details>
  <summary>例: 結果</summary>

```text
American History X 1998
BM25 score: 2.707

A Beautiful Mind 2001
BM25 score: 1.896

Legends of the Fall 1994
BM25 score: 1.663

Hacksaw Ridge 2016
BM25 score: 1.554

Night at the Museum 2006
BM25 score: 1.529
```

</details>


## <i class="fa-solid fa-square-chevron-right"></i> ハイブリッド検索

### <i class="fa-solid fa-code"></i> コード

この例では、"Movie" コレクション内から "history" という用語に対して最も高いハイブリッド検索スコアを持つエントリーを取得し、上位 5 件のタイトルと公開年を出力します。

<FilteredTextBlock
  text={PyCode}
  startMarker="# MetadataHybridSearch"
  endMarker="# END MetadataHybridSearch"
  language="py"
/>

### <i class="fa-solid fa-chalkboard"></i> コードの解説

結果はハイブリッド検索スコアに基づいています。ハイブリッド検索は BM25 とセマンティック / ベクトル検索の結果をブレンドします。

カスタムベクトルを使用しているため、`vector` パラメーターを使ってベクトルを手動でハイブリッドクエリに渡します。

`limit` パラメーターは、返却する最大件数を設定します。

`return_metadata` パラメーターには `MetadataQuery` クラスのインスタンスを渡し、検索結果で返却するメタデータを指定します。現在のクエリではハイブリッドスコアである `score` を返却しています。

<details>
  <summary>例: 結果</summary>

```text
Night at the Museum 2006
Hybrid score: 0.016

The Butterfly Effect 2004
Hybrid score: 0.014

Legends of the Fall 1994
Hybrid score: 0.014

Hidden Figures 2016
Hybrid score: 0.012

A Beautiful Mind 2001
Hybrid score: 0.012
```

</details>


## 質問とフィードバック

import DocsFeedback from '/_includes/docs-feedback.mdx';

<DocsFeedback/>