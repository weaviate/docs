---
title: マルチモーダル検索
description: マルチモーダル検索手法
---

import Tabs from '@theme/Tabs';  
import TabItem from '@theme/TabItem';  
import FilteredTextBlock from '@site/src/components/Documentation/FilteredTextBlock';  
import PyCode from '!!raw-loader!../_snippets/103_searches.py';  

 Weaviate を使用すると、意味に基づいて類似アイテムを見つけるセマンティック検索を実行できます。これは、データベース内のアイテムのベクトル埋め込みを比較することで実現します。  

マルチモーダルモデルを使用しているため、サポートされている任意のモダリティとの類似度に基づいてオブジェクトを検索できます。つまり、テキストまたは画像との類似度を基準に映画を検索できます。  

## <i class="fa-solid fa-square-chevron-right"></i> 画像クエリ

### <i class="fa-solid fa-code"></i> コード

この例では、「MovieMM」のエントリを [国際宇宙ステーションのこの画像](https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/International_Space_Station_after_undocking_of_STS-132.jpg/440px-International_Space_Station_after_undocking_of_STS-132.jpg) との類似度に基づいて検索し、上位 5 件の一致のタイトルと公開年を出力します。

<details>
  <summary>クエリ画像</summary>

![国際宇宙ステーション](https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/International_Space_Station_after_undocking_of_STS-132.jpg/440px-International_Space_Station_after_undocking_of_STS-132.jpg)

</details>

<FilteredTextBlock
  text={PyCode}
  startMarker="# MetadataMultimodalSearch"
  endMarker="# END MetadataMultimodalSearch"
  language="py"
/>

### <i class="fa-solid fa-chalkboard"></i> コードの解説

結果は、クエリとデータベースオブジェクトのベクトル埋め込み同士の類似度に基づきます。この場合、ベクトライザー モジュールが入力画像の埋め込みを生成します。  

`limit` パラメーターは返される結果の最大数を指定します。  

`return_metadata` パラメーターには `MetadataQuery` クラスのインスタンスを渡し、検索結果に含めるメタデータを指定します。現在のクエリでは、クエリとのベクトル距離を返しています。  

上位の結果はすべて宇宙をテーマにした映画であることから分かるように、出力はクエリ画像のトーンに非常によく似ています。  

<details>
  <summary>結果例</summary>

上位 5 件のポスター:  
<img src="https://raw.githubusercontent.com/weaviate-tutorials/edu-datasets/main/posters/157336_poster.jpg" alt="Interstellar" width="200" />  
<img src="https://raw.githubusercontent.com/weaviate-tutorials/edu-datasets/main/posters/49047_poster.jpg" alt="Gravity" width="200" />  
<img src="https://raw.githubusercontent.com/weaviate-tutorials/edu-datasets/main/posters/329865_poster.jpg" alt="Arrival" width="200" />  
<img src="https://raw.githubusercontent.com/weaviate-tutorials/edu-datasets/main/posters/95_poster.jpg" alt="Armageddon" width="200" />  
<img src="https://raw.githubusercontent.com/weaviate-tutorials/edu-datasets/main/posters/929_poster.jpg" alt="Godzilla" width="200" />  

Weaviate output:

```text
Interstellar 2014 157336
Distance to query: 0.354

Gravity 2013 49047
Distance to query: 0.384

Arrival 2016 329865
Distance to query: 0.386

Armageddon 1998 95
Distance to query: 0.400

Godzilla 1998 929
Distance to query: 0.441
```

</details>

### <i class="fa-solid fa-chalkboard"></i> レスポンスオブジェクト

返されるオブジェクトはカスタムクラスのインスタンスです。`objects` 属性は検索結果のリストで、それぞれが別のカスタムクラスのインスタンスになります。

各オブジェクトには、以下が適用されます:  
- 既定では、すべてのプロパティとその UUID が含まれますが、 blob データ型のプロパティは除外されます。  
    - `poster` プロパティは blob なので、既定では含まれません。  
    - `poster` プロパティを含める場合は、`return_properties` パラメーターで取得したい他のプロパティとともに指定してください。  
- 参照、メタデータ、ベクトルなど、その他の情報は既定では含まれません。  


## <i class="fa-solid fa-square-chevron-right"></i> テキスト検索

### <i class="fa-solid fa-code"></i> コード

この例では、「MovieMM」のエントリをクエリ「red」との類似度に基づいて検索し、上位 5 件の一致のタイトルと公開年を出力します。

<FilteredTextBlock
  text={PyCode}
  startMarker="# MetadataSemanticSearch"
  endMarker="# END MetadataSemanticSearch"
  language="py"
/>

### <i class="fa-solid fa-chalkboard"></i> コードの解説

結果は、クエリとデータベースオブジェクトのベクトル埋め込み同士の類似度に基づきます。この場合、ベクトライザー モジュールが入力テキストの埋め込みを生成します。  

その他のパラメーターは前の例と同じです。  

実際の結果には、ポスターに赤い配色が含まれる映画が表示されます。これは、 CLIP ベクトライザーが画像の色情報をベクトルにエンコードしているためです。  

<details>
  <summary>結果例</summary>

上位 5 件のポスター:  
<img src="https://raw.githubusercontent.com/weaviate-tutorials/edu-datasets/main/posters/383498_poster.jpg" alt="Deadpool 2" width="200" />  
<img src="https://raw.githubusercontent.com/weaviate-tutorials/edu-datasets/main/posters/338762_poster.jpg" alt="Bloodshot" width="200" />  
<img src="https://raw.githubusercontent.com/weaviate-tutorials/edu-datasets/main/posters/293660_poster.jpg" alt="Deadpool" width="200" />  
<img src="https://raw.githubusercontent.com/weaviate-tutorials/edu-datasets/main/posters/1271_poster.jpg" alt="300" width="200" />  
<img src="https://raw.githubusercontent.com/weaviate-tutorials/edu-datasets/main/posters/1669_poster.jpg" alt="The Hunt for Red October" width="200" />  

Weaviate output:

```text
Deadpool 2 2018 383498
Distance to query: 0.670

Bloodshot 2020 338762
Distance to query: 0.677

Deadpool 2016 293660
Distance to query: 0.678

300 2007 1271
Distance to query: 0.682

The Hunt for Red October 1990 1669
Distance to query: 0.683
```

</details>

### <i class="fa-solid fa-chalkboard"></i> レスポンスオブジェクト

返されるオブジェクトの形式は前の例と同じです。  


## ご質問とフィードバック

import DocsFeedback from '/_includes/docs-feedback.mdx';  

<DocsFeedback/>