---
title: ハンズオン
---

### <i class="fa-solid fa-chalkboard"></i>  準備

:::note 無料トライアルの OpenAI API キーを取得
このセクションでは、 OpenAI 推論エンドポイントを使用したクエリを含みます。まだ OpenAI アカウントをお持ちでない場合は、作成することをおすすめします。執筆時点では、 OpenAI が提供するトライアルクレジットで本演習に十分対応できます。
:::

## <i class="fa-solid fa-square-chevron-right"></i>  概要

import ReactPlayer from 'react-player/lazy'

<ReactPlayer className="react-player" url='https://youtu.be/8aHIAM3665c' controls='true'/>
<br/>

ご自身のWeaviateインスタンスをセットアップしクライアントをインストールできたので、実際に Weaviate を操作してみましょう。

### <i class="fa-solid fa-code"></i>  クライアントの生成

Weaviate インスタンスへ継続的にアクセスするための `client` オブジェクトを作成します。設定できるパラメーターは次のとおりです。

- **Host URL (必須)**  

  これはご自身のWeaviateインスタンスの場所を示します。 URL は次のようになります  

  ```
  https://your-sandbox-uo2vgb1z.weaviate.network
  ```

- **認証情報 (任意)**  

  認証が有効な場合、ここで認証情報を必ず指定してください。指定しないと Weaviate インスタンスへアクセスできません。  

  ```
  AbCdEfGhIjKlMnOpAXB6gbBIaxHDuuwWj5OD
  ```
- **追加ヘッダー (任意)**  

  追加ヘッダーを指定して、 Cohere、 Hugging Face、 OpenAI などの推論サービス用 API キーを渡すことができます。  

以下は、ご自身のWeaviateインスタンスに合わせて編集した、完全に設定されたクライアントのサンプルコードです。

<!-- TODO - add client code examples -->

import ClientInstantiationCode from './_snippets/academy.hello.client.instantiation.mdx';

<ClientInstantiationCode/>

### <i class="fa-solid fa-code"></i>  試してみましょう!

次に、 Weaviate インスタンスへ接続します。

1. 以下のクライアントコードを `connection_example.py` というファイルにコピーします。  
1. ファイルを編集して、ご自身の Weaviate URL を設定します。  
1. サンドボックス用の API キーに置き換えます。  

   サンドボックスの API キーは「Details」ボタンをクリックし、 Authentication タブの「API keys」で確認できます。キーは次のような形式です。  
1. ファイルを実行します。  

   ```
   python3 connection_example.py
   ```

import ClientCheckConnection from './_snippets/academy.hello.check.connection.mdx';

<ClientCheckConnection/>

おめでとうございます! Weaviate API への最初のリクエストが完了しました。 `meta` REST エンドポイントは、インスタンスの構成情報を返します。

Weaviate API では多くの操作が可能です。次のセクションでいくつか例を試してみましょう。詳細は [API ドキュメント](/weaviate/api/index.mdx) をご覧ください。

## <i class="fa-solid fa-square-chevron-right"></i>  Weaviate API とクライアント

### <i class="fa-solid fa-chalkboard"></i>  利用可能な API

Weaviate では 2 種類の API ― REST API と GraphQL API ― を使用しており、両者が連携して豊富な機能を提供します。

:::tip REST API と GraphQL API の違い
 **REST API** では次の操作が可能です:
- CRUD (Create, Read, Update, Delete) 操作  
- データベースのメタデータ取得  

 **GraphQL API** では次の操作が可能です:
- データ検索  
- データオブジェクト取得  
- 情報集約  
- ベクトル空間の探索  
:::

これらの機能については、このユニットを通じて学習します。

<details>
  <summary>REST とは？</summary>

REST は **RE**presentational **S**tate **T**ransfer の頭字語です。

REST API では複数のエンドポイントが用意されており、それぞれ固有の URL でアプリケーションとやり取りできます。

エンドポイントは階層構造で整理され、各エンドポイントがリソースを表します。クライアントはサーバーへリクエストを送信することで、これらリソースに関する情報を取得します。

</details>

<details>
  <summary>GraphQL とは？</summary>

GraphQL は API 用のクエリ言語です。

2015 年に Facebook から初めて公開され、現在は GraphQL Foundation がメンテナンスしています。

GraphQL はサーバーから情報を取得するためのクエリ言語仕様で、 **強い型付け** が特徴です。そのため、クライアントは受け取りたいデータ型を明示的に指定する必要があります。

</details>

### <i class="fa-solid fa-code"></i>  REST API へアクセスする

REST API と GraphQL API には Weaviate クライアントライブラリ、または適切にリクエストを整形できる他ツールからアクセスできます。

以下の例では、各タブに表示されるコードは機能的に同一です。 REST の呼び出しは双方ともメタ情報を取得し、 GraphQL の呼び出しも同じデータを要求します。

#### <i class="fa-solid fa-code-simple"></i> 例 1: REST とクライアントのリクエスト比較

import ClientRESTObjectGet from './_snippets/academy.clients.rest.object.get.mdx';

<ClientRESTObjectGet />
#### <i class="fa-solid fa-code-simple"></i> 例 2:  GraphQL  とクライアントリクエストの比較

import ClientGraphqlGet from './_snippets/academy.clients.graphql.get.mdx';

<ClientGraphqlGet />

では、もう少し本格的なクエリを試してみましょう。

## <i class="fa-solid fa-square-chevron-right"></i> クエリの実行

<!-- <img src={imageUrl} alt="Image alt" width="75%"/> -->

### <i class="fa-solid fa-code"></i> デモインスタンスへの接続

ここでは  Weaviate  のデモインスタンスに接続し、サンプルデータに対してクエリを実行してみます。インスタンスの詳細は次のとおりです。

:::info Demo instance details
- `url`: `https://edu-demo.weaviate.network`
- `Weaviate API key`: `readonly-demo`
:::

以下のインスタンス情報を使用し、次のことを試してください:
-  Weaviate  クライアントをインスタンス化する  
- 上述のようにメタデータを取得して接続を確認する  

下のスニペットを見ずにできればボーナスポイントです:

import ClientCheckConnectionEdudemo from './_snippets/academy.hello.check.connection.edudemo.mdx';

<details>
  <summary>デモインスタンスへ接続する</summary>

<ClientCheckConnectionEdudemo/>

</details>

### <i class="fa-solid fa-code"></i> ベクトル検索

次のクエリでは `WikiCity` オブジェクトを検索し、「Major European city」というテキストにもっとも近い都市を探します。

このクエリを実行するには、先ほど作成した接続ファイルを更新してください。

- メタ情報を取得する行をコメントアウトする  
- 先ほど作成した OpenAI 認証キーを追加する  
- 以下のコードスニペットを追加する  

import QueryVectorSearch from './_snippets/academy.hello.query.vector.search.mdx';

<QueryVectorSearch/>

:::tip Exercise
クエリコンセプトを "Major European city" から別のものに変えてみてください。結果は期待どおりでしょうか？
:::

### <i class="fa-solid fa-code"></i> 質問応答

この例では `WikiCity` オブジェクトを検索して、「When was the London Olympics?」に答えます。前回のコードを更新し、自分でも試してみてください。

import QueryQuestionAnswering from './_snippets/academy.hello.query.question.answering.mdx';

<QueryQuestionAnswering/>

:::tip Exercise
質問を "When was the London Olympics?" から別の都市に関連する質問へ変えてみてください。どのような結果になりますか？

どのような質問がよりうまく機能するか観察してみましょう。何かパターンに気づきますか？
:::

### <i class="fa-solid fa-code"></i> 生成検索

この例も `WikiCity` オブジェクトを検索しますが、  Weaviate  の `generative-openai` モジュールを使用して結果を変換します。ここでは、東南アジアの都市についてのツイートを生成します。

デモコードを再度更新し、試してみてください:

import QueryGenerativeSearch from './_snippets/academy.hello.query.generative.search.mdx';

<QueryGenerativeSearch/>

:::tip Exercise
プロンプトを次のように変えてみてください:

```
"Write a tweet with a potentially surprising fact from {wiki_summary}"
```

\{wiki_summary} を外すとどうなりますか？
:::

## <i class="fa-solid fa-square-chevron-right"></i> 復習

### <i class="fa-solid fa-pen-to-square"></i> 復習用演習

<Quiz questions={apiRecap} />

<Quiz questions={clientLimits} />

### <i class="fa-solid fa-lightbulb-on"></i> 重要なポイント

-  Weaviate  では  REST  と  GraphQL  の 2 種類の  API  を使用します。 REST  は CRUD 操作とメタデータ取得に使用され、 GraphQL  はデータ検索、データオブジェクトの取得、ベクトル空間の探索に使用されます。  
- クライアントライブラリは  REST / GraphQL  の両  API  へアクセスでき、  Weaviate  インスタンスとのやり取りを簡便にします。  
- デモの  Weaviate  インスタンスに接続し、ベクトル検索、質問応答クエリ、生成検索を実行しました。  

## 質問とフィードバック

import DocsFeedback from '/_includes/docs-feedback.mdx';

<DocsFeedback/>

import Quiz from '/src/components/Academy/quiz.js'
export const apiRecap = [{
  questionText: 'Which of the following is not true about the Weaviate API?',
  answerOptions: [
    {
      answerText: 'Weaviate users can use both REST and GraphQL.',
      isCorrect: false,
      feedback: 'They are both available for all users, and serve complementary roles in communicating with Weaviate.',
    },
    {
      answerText: 'The REST API can be used to retrieve instance configuration data.',
      isCorrect: false,
      feedback: 'the `meta` endpoint is available for this purpose.',
    },
    {
      answerText: 'Both GraphQL and REST APIs can be used in Weaviate to perform vector searches.',
      isCorrect: true,
      feedback: 'Only the GraphQL API performs vector searches.',
    },
    {
      answerText: 'None of the above.',
      isCorrect: false,
      feedback: 'The truth is out there!',
    },
  ]
}];
export const clientLimits = [{
  questionText: 'What can\'t Weaviate clients do?',
  answerOptions: [
    {
      answerText: 'Analyze the retrieved results.',
      isCorrect: true,
      feedback: 'They cannot perform any data analysis.',
    },
    {
      answerText: 'Communicate with the Weaviate REST API.',
      isCorrect: false,
      feedback: 'They can all perform REST API requests.',
    },
    {
      answerText: 'Communicate with the Weaviate GraphQL API.',
      isCorrect: false,
      feedback: 'They can all perform GraphQL API requests.',
    },
  ]
}];