---
title: 動的インデックスの詳細
---

import Tabs from '@theme/Tabs';  
import TabItem from '@theme/TabItem';  
import FilteredTextBlock from '@site/src/components/Documentation/FilteredTextBlock';  
import PyCode from '!!raw-loader!./_snippets/100_config.py';  

「 dynamic 」インデックスは、`hnsw` インデックスと `flat` インデックスの利点を組み合わせた “両方の長所取り” のアプローチです。

import DynamicAsyncRequirements from '/_includes/dynamic-index-async-req.mdx';

<DynamicAsyncRequirements/>

## <i class="fa-solid fa-square-chevron-right"></i> 主要な概念

簡単に言うと、`dynamic` インデックスは `flat` インデックスを基盤とし、コレクション内の ベクトル 数が既定のしきい値（デフォルトでは 10,000）を超えると自動的に `hnsw` インデックスへ変換されます。

その背景には、`flat` インデックスは小規模コレクションに対して非常に効率的ですが、検索時間がコレクション内の ベクトル 数に比例して増加するという性質があります。一方、`hnsw` インデックスは大規模コレクションでより効率的ですが、小規模コレクションではメモリのオーバーヘッドが大きく利点が少ないという問題があります。

コレクションごとのサイズが事前に分からない場合や、テナントによってサイズが大きく異なることが予想される場合には、`dynamic` インデックスが最適な選択肢となります。

マルチテナンシー構成では、すべてのテナントが最初は `flat` インデックスから開始し、コレクション内の ベクトル 数がしきい値を超えると自動的に `hnsw` インデックスへ切り替わります。

現時点では片方向の変換のみ対応しており、一度 `hnsw` に変換されると、後にしきい値を下回っても `flat` へは戻りません。

### <i class="fa-solid fa-chalkboard"></i> 距離メトリック

![ベクトル距離計算](./img/vector_distance.png)

インデックスで使用する距離メトリックは、 ベクトル 間の距離をどのように計算するかを決定します。HNSW インデックスでは、これが各 ベクトル をグラフ内のどこに配置するかにも影響します。

お使いの ベクトル に適したメトリックを選択してください。選定の際は、 ベクトル を生成したモデルのドキュメントを参照すると良いでしょう。

Weaviate のデフォルトメトリックは cosine ですが、[他にも利用可能なメトリック](/weaviate/config-refs/distances.md) を使用できます。

迷った場合は、多くのモデルで採用されている堅牢なデフォルトである cosine 距離をお勧めします。

## <i class="fa-solid fa-square-chevron-right"></i> Weaviate で dynamic インデックスを設定する

以下の各パラメーターは、コレクション作成時に指定できます。なお、`vector_cache_max_objects` は量子化を有効にし、かつ ベクトル キャッシュを有効にした場合にのみ使用されます。

### <i class="fa-solid fa-code"></i> 基本設定

以下のようにコレクションを dynamic インデックスに設定します。

<FilteredTextBlock
  text={PyCode}
  startMarker="# START ConfigDynamic"
  endMarker="# END ConfigDynamic"
  language="py"
/>

### <i class="fa-solid fa-code"></i> カスタム設定

`flat` インデックスが `hnsw` へ変換されるしきい値を設定できます。

さらに、インデックスの状態に応じて適用される `flat` および `hnsw` インデックスの各種パラメーターも指定可能です。

<FilteredTextBlock
  text={PyCode}
  startMarker="# START CustomConfigDynamic"
  endMarker="# END CustomConfigDynamic"
  language="py"
/>

## <i class="fa-solid fa-square-chevron-right"></i> 参考資料

- [Concepts: ベクトル インデックス](/weaviate/concepts/indexing/vector-index.md)
- [References: ベクトル インデックスのパラメーター](/weaviate/config-refs/indexing/vector-index.mdx)
- [コレクションの管理方法](../../../weaviate/manage-collections/index.mdx)
- [Weaviate Academy: 圧縮](../compression/index.md)

## 質問とフィードバック

import DocsFeedback from '/_includes/docs-feedback.mdx';

<DocsFeedback/>