---
title: Enable RQ compression
image: og/docs/cloud.jpg
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import FilteredTextBlock from '@site/src/components/Documentation/FilteredTextBlock';
import PyCode from '!!raw-loader!/\_includes/code/howto/configure-rq/update-collections-rq.py';
import TSCode from '!!raw-loader!/\_includes/code/howto/configure-rq/update-collections-rq.ts';

This guide shows you how to enable [RQ 8-bit compression](../../weaviate/configuration/compression/rq-compression.md) on existing collections in your Weaviate Cloud cluster. RQ compression significantly reduces vector dimensions costs while maintaining high recall.

:::warning Permanent Change
Once compression is enabled on a collection, it cannot be disabled. Always test compression on non-production data first.
:::

## Prerequisites

- A Weaviate [client library](/weaviate/client-libraries) installed
- [API key](../manage-clusters/authentication.mdx) with write access to your Weaviate Cloud cluster

## Connect to your cluster

First, establish a connection to your Weaviate Cloud cluster:

<Tabs className="code" groupId="languages">
  <TabItem value="py" label="Python">
      <FilteredTextBlock
        text={PyCode}
        startMarker="# START ConnectCode"
        endMarker="# END ConnectCode"
        language="py"
      />
  </TabItem>
  <TabItem value="ts" label="JavaScript/TypeScript">
      <FilteredTextBlock
        text={TSCode}
        startMarker="// START ConnectCode"
        endMarker="// END ConnectCode"
        language="ts"
      />
  </TabItem>
</Tabs>

Replace `YOUR-WEAVIATE-CLOUD-URL` with your cluster URL (e.g., `https://your-cluster.weaviate.network`) and `YOUR-API-KEY` with your authentication key.

## Update a single collection

The update syntax depends on your collection's **vector index type** (HNSW, flat, or dynamic) and whether it uses **named vectors**.

### HNSW index (default)

Most collections use the HNSW index. To enable RQ 8-bit compression:

<Tabs className="code" groupId="languages">
  <TabItem value="py" label="Python">
      <FilteredTextBlock
        text={PyCode}
        startMarker="# START UpdateSingleCollectionHNSW"
        endMarker="# END UpdateSingleCollectionHNSW"
        language="py"
      />
  </TabItem>
  <TabItem value="ts" label="JavaScript/TypeScript">
      <FilteredTextBlock
        text={TSCode}
        startMarker="// START UpdateSingleCollectionHNSW"
        endMarker="// END UpdateSingleCollectionHNSW"
        language="ts"
      />
  </TabItem>
</Tabs>

:::note Named vectors
If your collection uses named vectors (not "default"), update the `name` parameter to match your vector name.
:::

### Flat index

Compression settings on flat indexes are immutable after collection creation. You cannot enable or change compression on an existing flat index. To use RQ compression with a flat index, you must specify the compression settings when creating the collection.

### Dynamic index

For collections using the dynamic index, you can update the HNSW compression settings. Note that the flat index portion of a dynamic index cannot be modified after creation:

<Tabs className="code" groupId="languages">
  <TabItem value="py" label="Python">
      <FilteredTextBlock
        text={PyCode}
        startMarker="# START UpdateSingleCollectionDynamic"
        endMarker="# END UpdateSingleCollectionDynamic"
        language="py"
      />
  </TabItem>
  <TabItem value="ts" label="JavaScript/TypeScript">
      <FilteredTextBlock
        text={TSCode}
        startMarker="// START UpdateSingleCollectionDynamic"
        endMarker="// END UpdateSingleCollectionDynamic"
        language="ts"
      />
  </TabItem>
</Tabs>

### Legacy collections (pre-named vectors)

Collections created before Weaviate v1.24 (when named vectors were introduced) use a different schema structure. For these collections, use `vector_index_config` directly instead of `vector_config`:

<Tabs className="code" groupId="languages">
  <TabItem value="py" label="Python">
      <FilteredTextBlock
        text={PyCode}
        startMarker="# START UpdateLegacyCollection"
        endMarker="# END UpdateLegacyCollection"
        language="py"
      />
  </TabItem>
  <TabItem value="ts" label="JavaScript/TypeScript">
      <FilteredTextBlock
        text={TSCode}
        startMarker="// START UpdateLegacyCollection"
        endMarker="// END UpdateLegacyCollection"
        language="ts"
      />
  </TabItem>
</Tabs>

## Update multiple collections

Before updating multiple collections, you should understand the index types in your cluster. Different index types require different update syntax.

### List collections by index type

The following example categorizes your collections by their vector index types:

<Tabs className="code" groupId="languages">
  <TabItem value="py" label="Python">
      <FilteredTextBlock
        text={PyCode}
        startMarker="# START ListCollectionsByIndexType"
        endMarker="# END ListCollectionsByIndexType"
        language="py"
      />
  </TabItem>
  <TabItem value="ts" label="JavaScript/TypeScript">
      <FilteredTextBlock
        text={TSCode}
        startMarker="// START ListCollectionsByIndexType"
        endMarker="// END ListCollectionsByIndexType"
        language="ts"
      />
  </TabItem>
</Tabs>

### Update multiple collections

The following example enables RQ compression on HNSW collections in batches. To avoid cluster instability, limit each batch to approximately 100 collections:

<Tabs className="code" groupId="languages">
  <TabItem value="py" label="Python">
      <FilteredTextBlock
        text={PyCode}
        startMarker="# START UpdateMultipleCollections"
        endMarker="# END UpdateMultipleCollections"
        language="py"
      />
  </TabItem>
  <TabItem value="ts" label="JavaScript/TypeScript">
      <FilteredTextBlock
        text={TSCode}
        startMarker="// START UpdateMultipleCollections"
        endMarker="// END UpdateMultipleCollections"
        language="ts"
      />
  </TabItem>
</Tabs>

:::warning Batch size limits
Enabling compression on too many collections at once can cause cluster instability or crashes. Process collections in batches of no more than 100, and for very large collections, update them one at a time.
:::

:::tip Dry run
Consider adding a "dry run" mode that only prints what would change without actually updating collections. Comment out the `collection.config.update()` call and test the logic first.
:::

## Performance considerations

Enabling compression requires additional memory during the encoding process. Plan your compression rollout carefully to avoid resource exhaustion.

### Memory usage during compression

When compression is enabled on an existing collection, Weaviate re-encodes all vectors. This process temporarily increases memory usage.

**Example**: A collection with 1 million objects and 1,536 dimensions uses approximately 6.5 GB of memory before compression. During the compression process, memory usage increases by approximately 1.5 GB (~23% overhead) before settling to the compressed size.

### Recommended approach for large clusters

Enabling compression on too many collections simultaneously can cause cluster instability or crashes. Follow these guidelines to safely roll out compression:

For clusters with multiple collections or large vector counts:

1. **Assess your cluster**: Use the [list collections script](#list-collections-by-index-type) to understand what you're working with
2. **Process in batches**: Limit each batch to approximately 100 collections to avoid overwhelming cluster resources
3. **Handle large collections individually**: For very large collections (millions of objects), enable compression one collection at a time
4. **Build in buffers**: Add sufficient delays between batches to allow compression to complete before starting the next batch
5. **Start with smaller collections**: Test on smaller collections first to understand timing and resource impact before compressing larger ones

## Verify compression status

After enabling compression, verify the configuration:

<Tabs className="code" groupId="languages">
  <TabItem value="py" label="Python">
      <FilteredTextBlock
        text={PyCode}
        startMarker="# START CheckCompressionStatus"
        endMarker="# END CheckCompressionStatus"
        language="py"
      />
  </TabItem>
  <TabItem value="ts" label="JavaScript/TypeScript">
      <FilteredTextBlock
        text={TSCode}
        startMarker="// START CheckCompressionStatus"
        endMarker="// END CheckCompressionStatus"
        language="ts"
      />
  </TabItem>
</Tabs>

You should see output confirming the quantizer type is `rq` with `bits: 8`.

## What happens after enabling compression?

When you enable RQ compression on an existing collection:

1. **Existing vectors are re-encoded**: Weaviate automatically converts existing vector data to use RQ compression
2. **Storage and memory usage are reduced**: Less disk space and RAM are required for vector data
3. **Query performance**: Query speed remains similar with minimal recall impact (typically 1-2%)
4. **Irreversible**: The change cannot be undone

:::info Compression timing
For large collections, the compression process may take some time. Your collection remains queryable during this process, but you may see temporary performance impacts during the conversion.
:::

## Best practices

- **Test first**: Always test compression on a non-production cluster or collection first
- **Avoid bulk updates on large clusters**: Do not loop through many large collections at once; process them individually or with sufficient delays
- **Allow completion time**: Large collections may take significant time to re-encode all vectors
- **Monitor performance**: Check query recall and latency after enabling compression
- **Backup data**: Although compression is safe, consider backing up critical data before making changes

## Further resources

- [How-to configure: Rotational quantization (compression)](../../weaviate/configuration/compression/rq-compression.md)
- [Concepts: Vector quantization](../../weaviate/concepts/vector-quantization.md)
- [Starter guides: Managing resources - Compression](../../weaviate/starter-guides/managing-resources/compression.mdx)

## Questions and feedback

import DocsFeedback from '/\_includes/docs-feedback.mdx';

<DocsFeedback/>
